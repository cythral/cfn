trigger:
  - master
  - develop
  - release/*
  - feature/*
  - bugfix/*
  - hotfix/*
  - refs/tags/*

variables:
  suffix: -CI.$(Build.BuildId)

steps:
  - bash: |
      if [ $(Build.SourceBranch) ~= refs/tags/* ]; then \
        echo "##vso[task.setvariable variable=suffix]"; \
      fi

  - task: DotNetCoreCLI@2
    inputs:
      command: build
      configuration: Release
      arguments: --version-suffix $(suffix)

  - task: DotNetCoreCLI@2
    inputs:
      command: test
      arguments: --no-build
  
  - bash: dotnet pack --no-build --version-suffix $(suffix)
    
  - task: DotNetCoreCLI@2
    inputs:
      command: push
      arguments: --version-suffix $(suffix)
      nuGetFeedType: internal
      configuration: Release
      publishVstsFeed: 9251c6a1-c000-47ee-8e03-02d656a9418f

  - task: NuGetCommand@2
    condition: and(succeeded(), startsWith(variables['Build.SourceBranch'], 'refs/tags/'))
    inputs:
      command: push
      nuGetFeedType: external
      publishFeedCredentials: NuGet